# Online shoppers, prediction of revenue

В этой работе акцент сделан на обширный разведочный анализ данных и непараметрические тесты, также развёртывание сервисов. Наиболее важные элементы работы:

1. Разведочный анализ данных (EDA) в главе 3 ноутбука
2. Построение ExplainerDashboard на базе наилучшей модели и оборочивание его в docker образ
   $ docker pull andreyoskin/dashboard

## Описание задачи

Пользователи онлайн магазинов посещают их с целью изучения ассортимента товаров, анализа рынка, а также для совершения покупок. Прибыль онлайн магазина напрямую зависит от того, какая доля покупателей, посетивших страницу с товаром, совершила сделку, купив этот товар. Чем выше конверсия посетителей в совершенные ими сделки, тем выше доход магазина. В связи с этим интересно изучить связь поведения пользователя и параметров его системы с вероятностью покупки в интернет магазине. В данной работе проведено изучение данных и построение модели предсказания совершения сделки пользователем на основе информации о его действиях на сайте интернет магазина.

## Набор данных

Данные содержат 12330 строк, в каждой из которых содержится информация об одной сессии пользователя. Данные были собраны в течение одного года, пользователи не повторяются. В данных содрежится 17 векторов предикторов и 1 вектор целевой переменной.

Целевой переменной является является величина `Revenue`, принимающая значения True или False в зависимости от того, была совершена сделка или нет. Данные не сбалансированы относительно этой переменной, пользователей совершивших покупку в них значительно меньше, чем не совершивших.

Предикторы `Administrative`, `Administrative Duration`, `Informational`, `Informational Duration`, `Product Related` и `Product Related Duration` обозначают количество страниц различных, посещённых пользователем в течение сессии, а также время, проведённое им на этих страницах.

`Bounce Rate` - доля пользователей, зашедших на сайт с данной страницы и покинувших его без совершенния дальнейших действий.
`Exit Rate` - доля просмотров данной страницы, в которых она была последней в сессии по отношению к полному числу просмотров страницы
`Page Value` feature represents the average value for a web page that a user visited before completing an e-commerce transaction.

`Special Day` показывате близость дня, в который проходила сессия к какому-либо празнику.

Набор данных также содержит информацию об операционной сиситеме, браузере, регионе пользователя, типе его трафика, а также классификации самого пользователся (постоянный, новый). Также в данных есть сведения о месяце транзакции и о том, был это будний день или выходной.

## EDA

В первой части проекта был выполнен однофакторный и корреляционный анализ. Была изучена связь предикторов с целевой переменной и друг с другом. На основании анализа были сделаны выводы о том, какие предикторы оказывают наибольшее влияние на значение целевой переменной, а также то, какие преобразования над ними целесообразно произвести.

## Трансформация данных и отбор предикторов на основании 

Для существенной части количественных переменных в данном наборе характерны "хвосты" в правой части распределения. Чтобы приблизить эти распределения к нормальным было применено логарифмирование. Кроме того, часть перменных попарно скореллированы (например, `Administrative` и `Administrative Duration`), что позволяет исключить одну переменную из каждой пары. Это позволило улучшить качество модели.

## Выбор модели и дальнейший отбор предикторов

В качестве моделей для предсказания целевой переменной были рассмотрены:
1. Naive Bayes Classifier (NB)
2. K Nearest Neighbors Classifier (KNN)
3. CatBoost Classifier

Было проведено исследовние для выявления лучшей модели. В частности, сравнивались NB и KNN с категориальными переменными и без них, а также с подбором оптимальных гиперпараметров и без подбора. В результате было обнаружено, что KNN позволяет добиться лучшего, чем у NB показателя метрики ROC AUC на тестовом наборе данных после применения техники балансировки классов SMOTE и подбора гиперпараметров.

В качестве референса также был обучен классификатор из библиотеки CatBoost. Выбор данной модели обусловлен тем, что она оптимальным образом кодирует категориальные предикторы, а также тем, что на практике бустинги часто показывают лучшие результаты, чем более классические модели KNN и NB. Таким образом CatBoost является простым и мощным инструментом для решения данной задачи.

Было произведено несколько циклов обучения CatBoost классификатора с параметрами по умолчанию для выявления наименее важных для модели предикторов. Исключаемые предикторы выбирались по двум критериям:
1. Предиктор имеет низкую "importance" для обученного классификатора
2. Предиктор имеет близкую к нулю или отрицательную Permutation impotance

После отбора наиболее важных для модели переменных был произведён тюнинг гиперпараметров классфикатора с целью получения наилучшей метрики качества ROC AUC. В итоге CatBoost показал результаты (ROC AUC) выше, чем наиболее успешная из первых двух моделей.

## Развёртывание explainerdashboard с помощью Docker

Финальным этапом работы на проектом являлось построение explainerdashboard и упаковка его в интерактивную страничку с помощью  контейнера Docker. Все необходимые файлы для создания docker образа находятся в папке app данного репозитория. Чтобы собрать docker образ необходимо внутри папки app последовтельно проделать следующие действия:

1. Запустить eda.py для подготовки данных (трансформации и сохранения нового .csv файла)
2. Запустить model.py для обучения и сохранения обученного CatBoost классфикатора в .cbm файл
3. В консоли выполнить следующие команды для сборки docker образа и его запуска <br>
   $ docker build -t dashboard . <br>
   $ docker run -p 9050:9050 dashboard
4. После этого можно перейти по ссылке и изучить предсказания модели

В файле app.py происходит применение модели к тренировочным данным, его запускать не нужно. Инструкции для Docker содержатся внутри Dockerfile.

Также готовый образ можно скачать с dockerhub командой в терминале
$ docker pull andreyoskin/dashboard

## Collaborators

Проект был выполнен в рамках курса "Разведочный анализ и основы разработки" на платформе Stepik

https://stepik.org/course/177213/syllabus

Авторы курса

https://github.com/aiedu-courses
